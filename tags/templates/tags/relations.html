<!DOCTYPE html>
<html>
  <head>
    <title>
      LastFM tag relations
    </title>
  </head>
  
  <body>
    
    <!-- search form -->
    <form method="GET" action="{% url 'tags:relations' %}">
      <input type="search" name="s">
      <input type="submit" value="search">
    </form>
    <!-- -->
    
    <!-- -->
    <a href="{% url 'tags:index' %}">home</a>
    <!-- -->
    
    <h1>Tags related to: {{ searched }}</h1>
    <input type="button" id="compare" value="compare to LastFM's similar tags">
    
    
    <table id="myTable">
      <tr>
        <th id="ourTag">tag</th>
        <th id="ourMetric">metric</th>
      </tr>
      
      <tbody id="myTbody">
        {% for name, metric in object_list %}
        <tr>  
          <td>
            {{ name }}
          </td>
          <td>
            {{ metric }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    <table>
      
      
      
    
    <div id="paginate">
      {% if is_paginated %}
        {% if page_obj.has_previous %}
          <a href="{% url 'tags:relations' %}?s={{ searched }}&page={{ page_obj.previous_page_number }}">Previous</a>
        {% endif %}

         Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        
        {% if page_obj.has_next %}
            <a href="{% url 'tags:relations' %}?s={{ searched }}&page={{ page_obj.next_page_number }}">Next</a>
        {% endif %}

      {% endif %}
    </div>
    

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.js" type="text/javascript"></script>
    <script type="text/javascript">
      function seeComparison(){
        $.ajax({
          url: "{% url 'tags:compare' %}?s={{ searched }}",
          type: 'GET',
          dataType: 'json',
          success: function(data, textstatus, jqXHR){
            appendData(data);
          },
          error: function(data, textstatus, jqXHR){
            alert("Ooops, error!");
          }
        });
      }
      
      function appendData(somedata){
      /*
      This function takes data returned from AJAX get and 
      makes a new column to display the tags from 
      lastFM's getSimilarTag api call. 
      Before anything, it cleans up the table first!
      */
        cleanUp();
        $('#myTable').find("tr:first").append("<th>LastFM tag</th>");
        $('#myTbody tr').each(function(index){
          $(this).append("<td>" + somedata[index] + "</td>");
        });
      }
      
      function cleanUp(){
      /* 
      Hides the metric column.
      Hides pagination, because LastFM similar tags method
      shows only 50 tags.
      */
        $('td:nth-child(2)').hide();
        $('#ourMetric').hide();
        $('#paginate').hide();
        $('#compare').hide();
      }
      
      $(document).ready(function(){
        
        $('#compare').click(function(){
        
          seeComparison();
        });
        
      });
    </script>
    
  </body>
</html>